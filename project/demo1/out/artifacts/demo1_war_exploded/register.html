<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Create an account</title>
    <link rel="stylesheet" href="/lib/css/elementUI_index.css">
    <link rel="stylesheet" href="/lib/css/register_style.css">
</head>
<body>
    <div id="app">
        <el-container class="main-box">
            <el-aside class="left-box">
                <!--主页导向图标-->
                <button @click="gotoHome"><i class="el-icon-position"></i></button>

                <div class="time-guide">
                    <el-steps direction="vertical" space="8rem">
                        <el-step title="请输入账号信息" description="设置该账号信息将方便您的下次登录使用"></el-step>
                        <el-step title="请输入用户信息" description="我们将保护您的个人隐私信息，同时方便系统确认您的真实身份"></el-step>
                        <el-step title="提交用户信息" description="到这一步，您将完成注册，开始您的新世界体验"></el-step>
                    </el-steps>
                </div>
                <!--表单提交-->
                <div class="control-form">
                    <button @click="submitForm('ruleForm')">立即创建</button>
                    <button @click="resetForm('ruleForm')">重置</button>
                </div>
            </el-aside>
            <el-main class="right-box">
                <h1>Set up your account</h1>
                <h4>Create an account for yourself,you can use it to note your own information</h4>
                <div class="register-form">
                    <el-form :model="ruleForm" :rules="rules" ref="ruleForm" label-width="100px" class="demo-ruleForm">

                        <el-col :span="24">
                            <el-form-item label="Username" prop="username">
                                <el-input v-model="ruleForm.username"
                                          placeholder="please input your username"></el-input>
                            </el-form-item>
                        </el-col>

                        <el-col :span="24">
                            <el-form-item label="Password" prop="password">
                                <el-input type="password" v-model="ruleForm.password"
                                          placeholder="please input your password" :show-password="true"></el-input>
                            </el-form-item>
                        </el-col>

                        <el-col :span="12">
                            <el-form-item label="Name" prop="name">

                                <el-input v-model="ruleForm.name" placeholder="please input your name"></el-input>
                            </el-form-item>
                        </el-col>

                        <el-col :span="12">
                            <el-form-item label="Birthday" prop="birthday" required>
                                <el-date-picker type="date" placeholder="please set your birthday"
                                                v-model="ruleForm.birthday"
                                                @change="compute_age" style="width: 100%;"></el-date-picker>
                            </el-form-item>
                        </el-col>

                        <el-col :span="24">
                            <el-form-item label="Email" prop="email">
                                <el-input type="text" v-model="ruleForm.email"
                                          placeholder="please input your email"></el-input>
                            </el-form-item>
                        </el-col>

                        <el-col :span="24">
                            <el-form-item label="Phone" prop="phone">
                                <el-input type="text" v-model="ruleForm.phone"
                                          placeholder="please input your phone"></el-input>
                            </el-form-item>
                        </el-col>

                        <el-col :span="24">
                            <el-form-item label="Address" prop="address">
                                <el-input type="text" v-model="ruleForm.address"
                                          placeholder="please input your address"></el-input>
                            </el-form-item>
                        </el-col>
                    </el-form>
                    <h4>Already have an account?let's go to <a href="/login.html">login</a></h4>
                </div>
            </el-main>
        </el-container>
    </div>
</body>
<script src="/lib/js/vue.js"></script>
<script src="/lib/js/elementUI_index.js"></script>
<script src="/lib/js/axios.min.js"></script>
<script>
    let app = new Vue({
        el: "#app",
        data: {
            isAdmin: "普通用户",
            ruleForm: {},
            rules: {
                username: [
                    {required: true, message: 'username empty', trigger: 'blur'},
                    {min: 3, max: 5, message: 'username length:3-5', trigger: 'blur'}
                ],
                password: [
                    {required: true, message: "password empty", trigger: 'blur'},
                    {min: 3, max: 5, message: "password length:3-5", trigger: 'blur'}
                ],
                name: [
                    {required: true, message: "name empty", trigger: 'blur'},
                ],
                birthday: [
                    {type: "date", required: true, message: 'birthday empty', trigger: 'blur'},
                ],
                email: [
                    {required: true, message: "email empty", trigger: "blur"},
                    {min: 3, max: 5, message: "email length:3-5", trigger: "blur"}
                ],
            }
        },
        methods: {
            //前往主页
            gotoHome: function () {
                location.href = "/index.html";
            },
            //重置登录表单内容
            resetForm: function (formName) {
                this.$refs[formName].resetFields();
            },
            //提交注册表单
            submitForm: function (formName) {
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        // 表单验证成功
                        //    axios提交表单
                        axios.post("/user/register", this.ruleForm).then((res) => {
                            if (res.data.flag) {
                                let dom = this;
                                this.$message.success(res.data.msg);
                                setTimeout((function (){dom.$message.info("即将为您跳转到登录页面...");}),500);
                                //设置定时跳转
                                setTimeout((function (){location.href="/login.html"}),2000);
                            } else {
                                this.$message.error(res.data.msg);
                            }
                        });
                    } else {
                        //表单验证失败
                        this.$message.error("所填表单信息错误 -_-");
                        return false;
                    }
                });
            },
            // 年龄计算
            compute_age: function () {
                app.ruleForm.age = new Date(new Date() - app.ruleForm.birthday).getFullYear() - 1970;
            },
        },
    })
</script>
</html>